<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Playfair Cipher</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(to right, #74ebd5, #ACB6E5);
        color: #333;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }
    .container {
        background-color: rgba(255, 255, 255, 0.9);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        max-width: 500px;
        width: 100%;
    }
    h1 {
        text-align: center;
        margin-bottom: 25px;
        color: #333;
    }
    input, textarea, button {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        margin-bottom: 15px;
        border-radius: 5px;
        border: 1px solid #aaa;
        font-size: 16px;
    }
    button {
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
    }
    button:hover {
        background-color: #45a049;
    }
    label {
        font-weight: bold;
    }
</style>
</head>
<body>
<div class="container">
    <h1>Playfair Cipher</h1>
    <label for="text">Nhập văn bản:</label>
    <textarea id="text" rows="3" placeholder="Nhập văn bản..."></textarea>

    <label for="key">Nhập khóa:</label>
    <input type="text" id="key" placeholder="Nhập khóa...">

    <button onclick="encrypt()">Mã hóa</button>
    <button onclick="decrypt()">Giải mã</button>

    <label for="output">Kết quả:</label>
    <textarea id="output" rows="3" readonly></textarea>
</div>

<script>
function normalizeChar(c) {
    c = c.toUpperCase();
    if (c === 'J') c = 'I';
    return c;
}

function createMatrix(key) {
    let matrix = '';
    let used = new Set();
    key = key.toUpperCase();

    for (let ch of key) {
        if (/[A-Z]/.test(ch)) {
            ch = normalizeChar(ch);
            if (!used.has(ch)) {
                matrix += ch;
                used.add(ch);
            }
        }
    }

    for (let ch = 'A'.charCodeAt(0); ch <= 'Z'.charCodeAt(0); ch++) {
        let c = String.fromCharCode(ch);
        if (c === 'J') continue;
        if (!used.has(c)) {
            matrix += c;
            used.add(c);
        }
    }
    return matrix;
}

function findPosition(c, matrix) {
    c = normalizeChar(c);
    let idx = matrix.indexOf(c);
    return { row: Math.floor(idx / 5), col: idx % 5 };
}

function prepareText(text) {
    text = text.toUpperCase().replace(/[^A-Z]/g, '').replace(/J/g, 'I');
    let result = '';
    for (let i = 0; i < text.length; i++) {
        result += text[i];
        if (i + 1 < text.length && text[i] === text[i + 1]) {
            result += 'X';
        }
    }
    if (result.length % 2 !== 0) result += 'X';
    return result;
}

function processPlayfair(text, key, encrypt=true) {
    let matrix = createMatrix(key);
    let prepared = prepareText(text);
    let shift = encrypt ? 1 : 4;
    let result = '';

    for (let i = 0; i < prepared.length; i += 2) {
        let a = prepared[i], b = prepared[i + 1];
        let posA = findPosition(a, matrix);
        let posB = findPosition(b, matrix);

        if (posA.row === posB.row) {
            result += matrix[posA.row * 5 + (posA.col + shift) % 5];
            result += matrix[posB.row * 5 + (posB.col + shift) % 5];
        } else if (posA.col === posB.col) {
            result += matrix[((posA.row + shift) % 5) * 5 + posA.col];
            result += matrix[((posB.row + shift) % 5) * 5 + posB.col];
        } else {
            result += matrix[posA.row * 5 + posB.col];
            result += matrix[posB.row * 5 + posA.col];
        }
    }
    return result;
}

function encrypt() {
    let text = document.getElementById('text').value;
    let key = document.getElementById('key').value;
    document.getElementById('output').value = processPlayfair(text, key, true);
}

function decrypt() {
    let text = document.getElementById('text').value;
    let key = document.getElementById('key').value;
    document.getElementById('output').value = processPlayfair(text, key, false);
}
</script>
</body>
</html>
